# ИИ-ассистент «Ким»

Персональный ассистент в двух режимах:
- Локальный голосовой ассистент для Windows
- Приватный Telegram-бот

## Структура проекта

```
/src
  /kim_core      - ядро ассистента (конфиг, LLM, промпты, логирование)
  /kim_voice     - голосовая часть (hotword, STT, TTS)
  /kim_telegram  - Telegram-бот
  /kim_scheduler - планировщик (Stage 2)
  /kim_desktop   - взаимодействие с ПК (Stage 2)
  /kim_settings_panel - панель настроек (Stage 2)
/tests           - тесты
/scripts         - утилиты
/docs            - документация
```

## Установка

1. Установите Python 3.10+
2. Скопируйте `.env.example` в `.env` и заполните переменные
3. Установите зависимости: `pip install -r requirements.txt`

## Конфигурация

Конфигурация приложения загружается из файла `.env` в корне проекта.

### Основные переменные окружения

- `MODE` — режим работы (`dev` или `prod`). По умолчанию: `dev`
- `LOG_LEVEL` — уровень логирования (`DEBUG`, `INFO`, `WARNING`, `ERROR`). По умолчанию: `INFO`
- `OPENROUTER_API_KEY` — API-ключ для OpenRouter (обязателен в режиме `prod`)
- `BOT_TOKEN` — токен Telegram-бота (обязателен в режиме `prod`)
- `MODEL_FAST` — быстрая модель LLM. По умолчанию: `openrouter/fast`
- `MODEL_SMART` — умная модель LLM для сложных задач. По умолчанию: `openrouter/smart`
- `TOKEN_BUDGET_DAILY` — дневной лимит токенов. По умолчанию: `50000`

В режиме `prod` приложение проверяет наличие обязательных переменных (`OPENROUTER_API_KEY` и `BOT_TOKEN`) и выдаёт ошибку при их отсутствии.

## Интеграция с OpenRouter

Проект использует OpenRouter API для работы с LLM-моделями через два основных компонента:

### OpenRouterClient

Асинхронный клиент для взаимодействия с OpenRouter API. Обрабатывает запросы, ошибки сети и парсит ответы с информацией об использовании токенов.

### LLMRouter

Маршрутизатор моделей, который:

- **Автоматически выбирает модель** на основе контекста запроса:
  - По умолчанию использует быструю модель (`MODEL_FAST`)
  - Переключается на умную модель (`MODEL_SMART`) при обнаружении триггеров

- **Управляет дневным лимитом токенов** (`TOKEN_BUDGET_DAILY`):
  - Отслеживает использование токенов за день
  - Автоматически сбрасывает счётчик при смене даты
  - Блокирует запросы при превышении лимита

### Триггеры для умной модели

Для переключения на более мощную модель используйте в запросе одну из фраз:

- «реши это GPT-5»
- «режим качества»
- «нужен максимальный анализ»

Триггерные фразы автоматически удаляются из сообщения перед отправкой в LLM.

## Запуск

Инструкции по запуску будут добавлены после реализации Stage 1.