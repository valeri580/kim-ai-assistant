# Интерпретация метрик точности hotword «Ким»

## Требование: точность ≥ 90%

В контексте детекции hotword «точность 90%+» обычно означает **Precision ≥ 0.90** (90%).

## Ключевые метрики

### 1. Precision (Точность) — **ГЛАВНАЯ МЕТРИКА**

**Определение:** Доля правильно распознанных hotword среди всех срабатываний.

```
Precision = TP / (TP + FP)
```

**Интерпретация:**
- **Precision = 1.0 (100%)** — идеально: все срабатывания были правильными, нет ложных срабатываний
- **Precision ≥ 0.9 (90%)** — отлично: из 10 срабатываний минимум 9 правильные
- **Precision < 0.9** — требуется улучшение: слишком много ложных срабатываний

**Почему это важно:**
- Ложные срабатывания раздражают пользователя
- Ассистент не должен активироваться на случайные слова
- **Требование KPI Stage 1: Precision ≥ 90%**

### 2. Recall (Полнота)

**Определение:** Доля правильно распознанных hotword среди всех случаев, когда hotword должен был сработать.

```
Recall = TP / (TP + FN)
```

**Интерпретация:**
- **Recall = 1.0 (100%)** — идеально: все случаи «Ким» распознаны
- **Recall ≥ 0.9 (90%)** — хорошо: распознаётся минимум 9 из 10 случаев
- **Recall < 0.9** — требуется улучшение: много пропущенных активаций

**Почему это важно:**
- Пользователь должен быть уверен, что ассистент его услышит
- Низкий Recall означает, что нужно громче/чётче произносить «Ким»

### 3. F1-Score (Гармоническое среднее)

**Определение:** Баланс между Precision и Recall.

```
F1 = 2 × (Precision × Recall) / (Precision + Recall)
```

**Интерпретация:**
- **F1 = 1.0** — идеальный баланс
- **F1 ≥ 0.9** — хороший баланс между точностью и полнотой
- Полезен для сравнения разных конфигураций

### 4. Accuracy (Общая точность)

**Определение:** Доля всех правильных предсказаний (и положительных, и отрицательных).

```
Accuracy = (TP + TN) / (TP + FP + FN + TN)
```

**Интерпретация:**
- **Accuracy = 1.0** — все предсказания правильные
- Может быть обманчивой, если данных одного класса намного больше другого

## Примеры интерпретации результатов

### Пример 1: Отличный результат ✅

```
Precision: 1.000 (100%)
Recall:    1.000 (100%)
F1-Score:  1.000 (100%)
Accuracy:  1.000 (100%)

TP: 10, FP: 0, FN: 0, TN: 10
```

**Интерпретация:**
- ✅ **Precision = 100%** — требование выполнено (≥ 90%)
- ✅ Нет ложных срабатываний (FP = 0)
- ✅ Нет пропущенных активаций (FN = 0)
- ✅ Идеальный результат

### Пример 2: Хороший результат ✅

```
Precision: 0.900 (90%)
Recall:    0.950 (95%)
F1-Score:  0.924
Accuracy:  0.950

TP: 19, FP: 2, FN: 1, TN: 18
```

**Интерпретация:**
- ✅ **Precision = 90%** — требование выполнено (≥ 90%)
- ⚠️ Есть 2 ложных срабатывания (FP = 2)
- ⚠️ Есть 1 пропущенная активация (FN = 1)
- ✅ Приемлемый результат, можно улучшить

### Пример 3: Требуется улучшение ❌

```
Precision: 0.800 (80%)
Recall:    1.000 (100%)
F1-Score:  0.889
Accuracy:  0.900

TP: 10, FP: 2, FN: 0, TN: 8
```

**Интерпретация:**
- ❌ **Precision = 80%** — требование НЕ выполнено (< 90%)
- ❌ Слишком много ложных срабатываний (FP = 2)
- ✅ Все случаи «Ким» распознаны (Recall = 100%)
- ⚠️ **Требуется автотюнинг или ручная настройка параметров**

## Что делать при Precision < 90%?

### Автоматический подход (автотюнинг)

Скрипт `test_hotword_accuracy.py` автоматически:
1. Уменьшает `min_hotword_confidence` на 0.02 за итерацию
2. Если много ложных срабатываний (FP > TP), увеличивает `min_chars_in_utterance`
3. Повторяет до достижения Precision ≥ 0.9 или максимум 10 итераций

### Ручная настройка

Если автотюнинг не помог, попробуйте:

1. **Увеличить `min_hotword_confidence`:**
   ```env
   HOTWORD_MIN_CONFIDENCE=0.6  # Было 0.5
   ```
   - Уменьшит ложные срабатывания
   - Может снизить Recall

2. **Увеличить `min_chars_in_utterance`:**
   ```env
   HOTWORD_MIN_CHARS=3  # Было 2
   ```
   - Отфильтрует короткие случайные слова
   - Может снизить Recall для коротких команд

3. **Включить адаптивный порог:**
   ```env
   HOTWORD_ADAPTIVE_THRESHOLD=1
   ```
   - Автоматически подстраивается под уровень шума

## Рекомендации по интерпретации

### Для Stage 1 (MVP)

**Минимальные требования:**
- ✅ **Precision ≥ 0.90** (90%) — обязательно
- ✅ **Recall ≥ 0.85** (85%) — желательно
- ✅ **F1-Score ≥ 0.90** — хороший баланс

### Для продакшена

**Рекомендуемые значения:**
- ✅ **Precision ≥ 0.95** (95%) — минимум ложных срабатываний
- ✅ **Recall ≥ 0.90** (90%) — пользователь должен быть уверен, что его услышат
- ✅ **F1-Score ≥ 0.92** — хороший баланс

## Практические советы

1. **Смотрите на Precision в первую очередь** — это главная метрика для hotword
2. **Анализируйте FP (False Positives)** — какие файлы вызывают ложные срабатывания?
3. **Анализируйте FN (False Negatives)** — какие файлы не распознаются?
4. **Используйте автотюнинг** — скрипт сам найдёт оптимальные параметры
5. **Тестируйте на реальных условиях** — добавьте файлы с фоновым шумом, разными голосами

## Заключение

**Требование "точность 90%+" = Precision ≥ 0.90**

В нашем тестировании:
- ✅ **Precision = 1.000 (100%)** — требование выполнено с запасом
- ✅ Все метрики на максимальном уровне
- ✅ Система готова к использованию

